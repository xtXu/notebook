# 数值优化——拟牛顿法

## 收敛速度

定义误差 $$e^k=x^k-x^*$$
为第 $k$ 次迭代的结果与最优解 $x^{*}$ 的差，则收敛速度可分为
+ 线性收敛：$\left\|e^{k+1}\right\|=C\left\|e^k\right\|$ （梯度下降法）
+ 超线性收敛：$\left\|e^{k+1}\right\|=C\left\|e^k\right\|^p, p>1$
+ 平方收敛：$\left\|e^{k+1}\right\|=C\left\|e^k\right\|^2$ （牛顿法）

## 拟牛顿的近似

对于正定的海森阵 $H$，牛顿法通过泰勒展开近似原函数:
$$
\begin{array}{c}
f(x)-f\left(x^k\right) \approx\left(x-x^k\right)^T g^k+\frac{1}{2}\left(x-x^k\right)^T H^k\left(x-x^k\right) \\
\text{Solve }  H^k d^k=-g^k
\end{array}
$$
为了解决牛顿法稳定性差和计算耗时的问题，**拟牛顿法**通过用矩阵 $M$ 代替海森阵 $H$，对原函数进行近似:
$$
\begin{array}{c}
f(x)-f\left(x^k\right) \approx\left(x-x^k\right)^T g^k+\frac{1}{2}\left(x-x^k\right)^T M^k\left(x-x^k\right) \\
\text{Solve }  M^k d^k=-g^k
\end{array}
$$
其中 $M$ 应满足：
+ 无需求解所有的二阶导数
+ 线性方程组有闭式解
+ 轻量，便于存储
+ **保证下降方向**
+ **包含曲率信息（局部的二次近似）**

### 下降方向
根据上文的近似公式，迭代方向满足
$$
M^k d^k=-g^k \Rightarrow d^k=-(M^k)^{-1}g^k
$$
为了保证下降方向，$d^k$ 需与负梯度方向 $-g=-\nabla f(x)$ 成锐角：
$$
\left\langle-g,-M^{-1} g\right\rangle=\left\langle g, M^{-1} g\right\rangle=g^T M^{-1} g>0
$$
即对于任意的 $\forall g\neq 0$，$g^T M^{-1} g>0$，即 $M$ 正定。  
因此，**当 $M$ 为正定矩阵时，方向 $d^{k}$ 一定为下降方向。**
### 曲率信息
According to the Taylor expansion:
$$
\nabla f(x)-\nabla f(y) \approx H(x-y)
$$
If
$$
\begin{aligned}
& \Delta x=x^{k+1}-x^k \\
& \Delta g=\nabla f\left(x^{k+1}\right)-\nabla f\left(x^k\right)
\end{aligned}
$$
then
$$
\Delta g \approx M^{k+1}\Delta x
$$
that is 
$$
\Delta x \approx B^{k+1}\Delta g, M^{k+1}B^{k+1}=I
$$
Because we need to solve $d=-M^{-1}g$, so directly get $B^{k+1}=(M^{k+1})^{-1}$ is better.
Infinitely many $B$ satisfy $\Delta x \approx B\Delta g$, so we can choose using a optimization problem.
$B^{k}$ may contain some info related to $B^{k+1}$, so we want $B^{k+1}$ close to $B^k$,
$$
\begin{array}{c}
\min _B \left\|B - B^k\right\|^2 \\
\begin{aligned}
\text { s.t. }  B&=B^{\mathrm{T}} \\
\Delta x &=B \Delta g
\end{aligned}
\end{array}
$$
However, the scale of each element of $B$ may differ a lot, so it's more reasonable to measure the relative change of the element:
$$
\begin{array}{c}
\min _B \left\| H^\frac{1}{2}\left(B - B^k\right)H^\frac{1}{2}\right\|^2 \\
\begin{aligned}
\text { s.t. }  B&=B^{\mathrm{T}} \\
\Delta x &=B \Delta g
\end{aligned}
\end{array}
$$
where $H$ is the average true Hessian from $x^k$ to $x^{k+1}$,
$$
H=\int_0^1 \nabla^2 f\left[(1-\tau) x^k+\tau x^{k+1}\right] d \tau
$$
***We don't know $H$, but the problem has an analytical solution independent of $H$.***
